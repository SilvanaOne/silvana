openapi: 3.0.0
info:
  title: Utilities API
  description: Exposes technical information and contract data of the Utility App
  version: 1.0.0
tags:
  - name: utility
servers:
  - url: "http://localhost:8080"
paths:
  /:
    get:
      tags: [common]
      operationId: "root"
      x-jvm-package: health
      responses:
        "200":
          description: ok
  /readyz:
    get:
      tags: [common]
      operationId: "isReady"
      x-jvm-package: health
      responses:
        "200":
          description: ok
        "503":
          description: service unavailable
  /livez:
    get:
      tags: [common]
      operationId: "isLive"
      x-jvm-package: health
      responses:
        "200":
          description: ok
        "503":
          description: service unavailable

  /api/utilities/v0/openapi:
    get:
      tags: [operator]
      operationId: "getOpenApiSpec"
      x-jvm-package: utility
      responses:
        "200":
          description: Returns the OpenApi specification
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        "500":
          description: OpenApi specification is not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/utilities/v0/operator:
    get:
      tags: [operator]
      operationId: "getOperator"
      x-jvm-package: utility
      responses:
        "200":
          description: Returns the operator party
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetOperatorResponse"
        "500":
          description: Operator party is not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/utilities/v0/package/all:
    get:
      tags: [operator]
      operationId: "getAllPackages"
      x-jvm-package: utility
      responses:
        "200":
          description: Returns package information that are in use
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/GetAllPackagesResponse"
        "500":
          description: Operator party is not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/utilities/v0/contract/instrument-configuration/all:
    get:
      tags: [operator]
      operationId: "getAllInstrumentConfigurations"
      x-jvm-package: utility
      responses:
        "200":
          description: Returns all instrument configurations
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetAllInstrumentConfigurationsResponse"
        "500":
          description: Operator party is not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/utilities/v0/contract/instrument-configuration:
    post:
      tags: [operator]
      operationId: "getInstrumentConfiguration"
      x-jvm-package: utility
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GetInstrumentConfigurationRequest"
      responses:
        "200":
          description: Returns the instrument configuration
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetInstrumentConfigurationResponse"
        "404":
          description: Instrument configuration not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Operator party is not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/utilities/v0/registry/mint/v0/offer:
    post:
      tags: [registry]
      operationId: "getMintOfferCreateContext"
      x-jvm-package: registry
      description: |
        Get the factory and choice context for creating a mint offer.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OfferMintRequest"
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FactoryWithChoiceContext"
        "400":
          $ref: "#/components/responses/400"
        "404":
          $ref: "#/components/responses/404"
        "500":
          $ref: "#/components/responses/500"

  /api/utilities/v0/registry/mint/v0/request:
    post:
      tags: [registry]
      operationId: "getMintRequestCreateContext"
      x-jvm-package: registry
      description: |
        Get the factory and choice context for creating a mint request.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RequestMintRequest"
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FactoryWithChoiceContext"
        "400":
          $ref: "#/components/responses/400"
        "404":
          $ref: "#/components/responses/404"
        "500":
          $ref: "#/components/responses/500"


  /api/utilities/v0/registry/burn/v0/offer:
    post:
      tags: [registry]
      operationId: "getBurnOfferCreateContext"
      x-jvm-package: registry
      description: |
        Get the factory and choice context for creating a burn offer.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OfferBurnRequest"
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FactoryWithChoiceContext"
        "400":
          $ref: "#/components/responses/400"
        "404":
          $ref: "#/components/responses/404"
        "500":
          $ref: "#/components/responses/500"


  /api/utilities/v0/registry/burn/v0/request:
    post:
      tags: [registry]
      operationId: "getBurnRequestCreateContext"
      x-jvm-package: registry
      description: |
        Get the factory and choice context for creating a burn request.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RequestBurnRequest"
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FactoryWithChoiceContext"
        "400":
          $ref: "#/components/responses/400"
        "404":
          $ref: "#/components/responses/404"
        "500":
          $ref: "#/components/responses/500"

  /api/utilities/v0/registry/mint/v0/offer/{mintOfferId}/choice-contexts/accept:
    post:
      tags: [registry]
      operationId: "getMintOfferAcceptContext"
      x-jvm-package: registry
      description: |
        Get the choice context to accept and execute a mint offer.
      parameters:
        - name: mintOfferId
          description: "The contract ID of the mint offer to accept."
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChoiceContext"
        "400":
          $ref: "#/components/responses/400"
        "404":
          $ref: "#/components/responses/404"
        "500":
          $ref: "#/components/responses/500"

  /api/utilities/v0/registry/mint/v0/request/{mintRequestId}/choice-contexts/accept:
    post:
      tags: [registry]
      operationId: "getMintRequestAcceptContext"
      x-jvm-package: registry
      description: |
        Get the choice context to accept and execute a mint request.
      parameters:
        - name: mintRequestId
          description: "The contract ID of the mint request to accept."
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChoiceContext"
        "400":
          $ref: "#/components/responses/400"
        "404":
          $ref: "#/components/responses/404"
        "500":
          $ref: "#/components/responses/500"

  /api/utilities/v0/registry/burn/v0/offer/{burnOfferId}/choice-contexts/accept:
    post:
      tags: [registry]
      operationId: "getBurnOfferAcceptContext"
      x-jvm-package: registry
      description: |
        Get the choice context to accept and execute a burn offer.
      parameters:
        - name: burnOfferId
          description: "The contract ID of the burn offer to accept."
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChoiceContext"
        "400":
          $ref: "#/components/responses/400"
        "404":
          $ref: "#/components/responses/404"
        "500":
          $ref: "#/components/responses/500"

  /api/utilities/v0/registry/burn/v0/request/{burnRequestId}/choice-contexts/accept:
    post:
      tags: [registry]
      operationId: "getBurnRequestAcceptContext"
      x-jvm-package: registry
      description: |
        Get the choice context to accept and execute a burn request.
      parameters:
        - name: burnRequestId
          description: "The contract ID of the burn request to accept."
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChoiceContext"
        "400":
          $ref: "#/components/responses/400"
        "404":
          $ref: "#/components/responses/404"
        "500":
          $ref: "#/components/responses/500"

components:
  responses:
    "400":
      description: "bad request"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
    "404":
      description: "not found"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
    "500":
      description: "Internal server error"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
  schemas:
    Error:
      type: object
      description: "A problem occurred with processing the request. For instance: syntactically invalid JSON body, missing required fields, etc."
      required:
        - error
        - error_description
      properties:
        error:
          description: An error code, e.g. invalid_token
          type: string
          default: unknown_error
        error_description:
          description: A description of the error
          type: string
          default: Something went wrong

    DisclosedContract:
      type: object
      required:
        - contractId
        - templateId
        - createdEventBlob
      properties:
        createdAt:
          type: string
          format: date-time
        contractId:
          type: string
        templateId:
          type: string
        domainId:
          type: string
        createdEventBlob:
          type: string
          description: The base64 encoded created event blob

    PartyCredentialRequirement:
      type: object
      required:
        - issuer
        - requiredClaims
      properties:
        issuer:
          type: string
          description: Required issuer of the credential
        requiredClaims:
          type: string
          description: Required (property, value) pairs that the holder has to have claims for as a subject
          items:
            $ref: "#/components/schemas/CredentialClaim"

    CredentialClaim:
      type: object
      required:
        - property
        - value
      properties:
        property:
          type: string
          description: The property of the claim
        value:
          type: string
          description: The value of the claim

    InstrumentIdentifier:
      type: object
      required:
        - source
        - id
        - scheme
      properties:
        source:
          description: The entity that originally created or issued the identifier.
          type: string
        id:
          description: The identifier for the instrument
          type: string
        scheme:
          description: The scheme or standard used for the identifier.
          type: string

    GetOperatorResponse:
      type: object
      required:
        - partyId
      properties:
        partyId:
          type: string
          description: The operator party id

    GetAllPackagesResponse:
      type: object
      required:
        - packages
      properties:
        packages:
          type: array
          items:
            $ref: "#/components/schemas/PackageDescriptor"

    PackageDescriptor:
      type: object
      description: Contains the package ids for a given package name
      required:
        - name
        - id
      properties:
        name:
          description: Name of the package
          type: string
        id:
          description: Package ID
          type: string

    GetInstrumentConfigurationRequest:
      type: object
      required:
        - registrar
        - instrumentIdentifier
      properties:
        registrar:
          type: string
          description: The registrar party id
        instrumentIdentifier:
          $ref: "#/components/schemas/InstrumentIdentifier"

    GetInstrumentConfigurationResponse:
      $ref: "#/components/schemas/InstrumentConfiguration"

    GetAllInstrumentConfigurationsResponse:
      type: object
      required:
        - instrumentConfigurations
      properties:
        instrumentConfigurations:
          type: array
          description: All instrument configurations
          items:
            $ref: "#/components/schemas/InstrumentConfiguration"

    InstrumentConfiguration:
      type: object
      required:
        - contract
        - payload
      properties:
        contract:
          $ref: "#/components/schemas/DisclosedContract"
        payload:
          $ref: "#/components/schemas/InstrumentConfigurationPayload"

    InstrumentConfigurationPayload:
      type: object
      required:
        - operator
        - provider
        - registrar
        - defaultIdentifier
        - additionalIdentifiers
        - issuerRequirements
        - holderRequirements
      properties:
        operator:
          type: string
          description: The operator party id
        provider:
          type: string
          description: The provider party id
        registrar:
          type: string
          description: The registrar party id
        defaultIdentifier:
          $ref: "#/components/schemas/InstrumentIdentifier"
        additionalIdentifiers:
          type: array
          description: Additional instrument identifiers
          items:
            $ref: "#/components/schemas/InstrumentIdentifier"
        issuerRequirements:
          type: array
          description: Credential requirements to mint/burn a given asset
          items:
            $ref: "#/components/schemas/PartyCredentialRequirement"
        holderRequirements:
          type: array
          description: Credential requirements to transfer/lock/unlock a given asset
          items:
            $ref: "#/components/schemas/PartyCredentialRequirement"

    TokenInformation:
      type: object
      required:
        - access_token
      properties:
        id_token:
          type: string
        access_token:
          type: string

    GetFactoryRequest:
      type: object
      required:
        - choiceArguments
      properties:
        choiceArguments:
          type: object
          description: |
            The arguments that are intended to be passed to the choice provided by the factory.
            To avoid repeating the Daml type definitions, they are specified as JSON objects.
            However the concrete format is given by how the choice arguments are encoded using the Daml JSON API

            The choice arguments are provided so that the registry can also provide choice-argument
            specific contracts, e.g., the configuration for a specific instrument-id.

    FactoryWithChoiceContext:
      description: |
        A factory contract together with the choice context required to exercise the choice
        provided by the factory. Typically used to implement the generic initiation of on-ledger workflows
        via a Daml interface.

        Clients SHOULD avoid reusing the same `FactoryWithChoiceContext` for exercising multiple choices,
        as the choice context MAY be specific to the choice being exercised.
      type: object
      required:
        - factoryId
        - choiceContext
      properties:
        factoryId:
          description: "The contract ID of the contract of the factory which can be used to create instruction."
          type: string
        choiceContext:
          $ref: "#/components/schemas/ChoiceContext"

    ChoiceContext:
      description: |
        The context required to exercise a choice on a contract via an interface.
        Used to retrieve additional reference date that is passed in via disclosed contracts,
        which are in turn referred to via their contract ID in the `choiceContextData`.
      type: object
      required:
        - choiceContextData
        - disclosedContracts
      properties:
        choiceContextData:
          description: "The additional data to use when exercising the choice."
          type: object
        disclosedContracts:
          description: |
            The contracts that are required to be disclosed to the participant node for exercising
            the choice.
          type: array
          items:
            $ref: "#/components/schemas/DisclosedContract"

    RequestBurnRequest:
      description: "The request to get the factory and choice context for creating a burn request."
      type: object
      required:
        - holder
        - holdingContractIds
        - instrumentId
      properties:
        holder:
          description: "The party whose holding will be burned."
          type: string
        holdingContractIds:
          description: "Contract ids of Holdings to be used for the burn."
          type: array
          items:
            type: string
        instrumentId:
          $ref: "#/components/schemas/InstrumentId"

    OfferBurnRequest:
      description: "The request to get the factory and choice context for creating a burn offer."
      type: object
      required:
        - holder
        - instrumentId
      properties:
        holder:
          description: "The party whose holding will be burned."
          type: string
        instrumentId:
          $ref: "#/components/schemas/InstrumentId"

    RequestMintRequest:
      description: "The request to get the factory and choice context for creating a mint request."
      type: object
      required:
        - holder
        - instrumentId
      properties:
        holder:
          description: "The party for whom the holding will be minted."
          type: string
        instrumentId:
          $ref: "#/components/schemas/InstrumentId"

    OfferMintRequest:
      description: "The request to get the factory and choice context for creating a mint offer."
      type: object
      required:
        - holder
        - instrumentId
      properties:
        holder:
          description: "The party for whom the holding will be minted."
          type: string
        instrumentId:
          $ref: "#/components/schemas/InstrumentId"

    InstrumentId:
      description: "The identifier of the instrument."
      type: object
      required:
        - admin
        - id
      properties:
        admin:
          description: "The party administering the instrument."
          type: string
        id:
          description: "The unique identifier of the instrument."
          type: string